<div class="container">
    <section class="header" (click)="user_card=false">
        <div class='logo-container'>
            <img src="assets/images/texto-logo.png" alt="">
        </div>

        <div class='user-container'>
            <!-- <div> -->
                <button mat-button (click)="$event.stopPropagation(); user_card=true ">
                    <img src="assets/images/user.png" class='user_img' alt="">
                </button>
                <div #userCard tabindex="0" (focusout)="user_card=false">
                    <mat-card class="card" [class]='{hide: !user_card}'>
                        <mat-card-header>
                            <mat-card-title>{{ currentUser.name }}</mat-card-title>
                            <mat-card-subtitle>{{ currentUser.email }}</mat-card-subtitle>
                            <div class="header-image">
                                <img src="assets/images/user.png">
                            </div>
                        </mat-card-header>
                        <mat-card-actions>
                            <button mat-button>{{ 'payments.open_profile_button' | translate }}</button>
                            <button (click)="logout()" mat-raised-button class="primary">{{ 'payments.logout_button' | translate }}</button>
                        </mat-card-actions>
                    </mat-card>
                </div>
            <!-- </div> -->
        </div>
    </section>

    <section class="body" [class]="{blur: blur}" (click)="user_card=false">
        <div class="content">
            <div class="content-top">
                <h1>{{ 'payments.page_title' | translate }}</h1>
                <button (click)="openAddPaymentPopup()" mat-flat-button class='add-btn' color="primary">{{ 'payments.add_payment_button' | translate }}</button>
            </div>

            <div class='table-container'>
                <div class='table-header'>
                    <div class="filters">
                        <mat-form-field appearance="outline">
                            <input [formControl]='usernameControl' matInput [placeholder]="'payments.username_search' | translate">
                            <mat-icon matSuffix>search</mat-icon>
                        </mat-form-field>
                        <button (click)="openFiltersPopup()" mat-flat-button class='search-btn'>
                            <mat-icon matSuffix>tune</mat-icon>
                            {{ 'payments.filter_label' | translate }}
                        </button>
                    </div>
    
                    <div class="paginator">
                        <app-paginator (change)="changePaginator($event)" [paginator]="paginator"></app-paginator>
                    </div>
                </div>

                <div class='table-body'>
                    <table mat-table [dataSource]="payments" class="mat-elevation-z8">
                        <ng-container matColumnDef="name">
                            <mat-header-cell *matHeaderCellDef>
                                {{ 'payments.user_column' | translate }}
                              <div class='sort-btn'>
                                <button (click)="sortBy('name', 'desc')" [class]="{ active: sort.field == 'name' && sort.order == 'desc' }" mat-icon-button>
                                    <mat-icon>expand_less</mat-icon>
                                </button>
                                <button (click)="sortBy('name', 'asc')" [class]="{ active: sort.field == 'name' && sort.order == 'asc' }" mat-icon-button>
                                    <mat-icon>expand_more</mat-icon>
                                </button>
                              </div>
                            </mat-header-cell>
                            <mat-cell *matCellDef="let payment">
                                <div class='cell-data img-payment-field'>
                                    <img class='img-payment' [src]="payment.image">
                                </div>
                                <div class='cell-data user-payment'>
                                    <span> {{ payment.name }} </span>
                                    <sub> @{{ payment.username }} </sub>
                                </div>
                            </mat-cell>
                        </ng-container>
                      
                        <ng-container matColumnDef="title">
                            <mat-header-cell *matHeaderCellDef>
                                {{ 'payments.title_column' | translate }}
                                <div class='sort-btn'>
                                    <button (click)="sortBy('title', 'desc')" [class]="{ active: sort.field == 'title' && sort.order == 'desc' }" mat-icon-button>
                                        <mat-icon>expand_less</mat-icon>
                                    </button>
                                    <button (click)="sortBy('title', 'asc')" [class]="{ active: sort.field == 'title' && sort.order == 'asc' }" mat-icon-button>
                                        <mat-icon>expand_more</mat-icon>
                                    </button>
                                </div>
                            </mat-header-cell>
                            <mat-cell *matCellDef="let payment"> {{ payment.title }} </mat-cell>
                        </ng-container>
                      
                        <ng-container matColumnDef="date">
                            <mat-header-cell *matHeaderCellDef>
                                {{ 'payments.date_column' | translate }}
                                <div class='sort-btn'>
                                    <button (click)="sortBy('date', 'desc')" [class]="{ active: sort.field == 'date' && sort.order == 'desc' }" mat-icon-button>
                                        <mat-icon>expand_less</mat-icon>
                                    </button>
                                    <button (click)="sortBy('date', 'asc')" [class]="{ active: sort.field == 'date' && sort.order == 'asc' }" mat-icon-button>
                                        <mat-icon>expand_more</mat-icon>
                                    </button>
                                </div>
                            </mat-header-cell>
                            <mat-cell *matCellDef="let payment">
                                <div class='cell-data'>
                                    <span> {{ payment.date | date:'dd MMM YYYY' }} </span>
                                    <sub> {{ payment.date | date:' h:mm a' }} </sub>
                                </div>
                        </mat-cell>
                        </ng-container>
                      
                        <ng-container matColumnDef="value">
                            <mat-header-cell *matHeaderCellDef>
                                {{ 'payments.value_column' | translate }}
                                <div class='sort-btn'>
                                    <button (click)="sortBy('value', 'desc')" [class]="{ active: sort.field == 'value' && sort.order == 'desc' }" mat-icon-button>
                                        <mat-icon>expand_less</mat-icon>
                                    </button>
                                    <button (click)="sortBy('value', 'asc')" [class]="{ active: sort.field == 'value' && sort.order == 'asc' }" mat-icon-button>
                                        <mat-icon>expand_more</mat-icon>
                                    </button>
                                </div>
                            </mat-header-cell>
                          <mat-cell *matCellDef="let payment"> {{ payment.value | currency:'R$ ' }} </mat-cell>
                        </ng-container>

                        <ng-container matColumnDef="isPayed">
                            <mat-header-cell *matHeaderCellDef>
                                {{ 'payments.paid_column' | translate }}
                                <div class='sort-btn'>
                                    <button (click)="sortBy('isPayed', 'desc')" [class]="{ active: sort.field == 'isPayed' && sort.order == 'desc' }" mat-icon-button>
                                        <mat-icon>expand_less</mat-icon>
                                    </button>
                                    <button (click)="sortBy('isPayed', 'asc')" [class]="{ active: sort.field == 'isPayed' && sort.order == 'asc' }" mat-icon-button>
                                        <mat-icon>expand_more</mat-icon>
                                    </button>
                                </div>
                            </mat-header-cell>
                            <mat-cell *matCellDef="let payment">
                                <mat-checkbox
                                    #isPayedCheckbox
                                    class="example-margin"
                                    color="accent"
                                    (click)="current_payment=payment; editPayment({isPayed: !payment.isPayed});"
                                    [checked]="payment.isPayed">
                                </mat-checkbox>
                            </mat-cell>
                        </ng-container>

                        <ng-container matColumnDef="action">
                            <mat-header-cell *matHeaderCellDef></mat-header-cell>
                            <mat-cell *matCellDef="let payment">
                                <div>
                                    <span (click)="openEditPaymentPopup(payment)" class="material-icons action-btn"> edit </span>
                                    <span (click)="openDeletePaymentPopup(payment)" class="material-icons action-btn"> highlight_off </span>
                                </div>
                            </mat-cell>
                        </ng-container>
                      
                        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                        <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
                      </table>
                </div>
            </div>
        </div>
    </section>
</div>
<app-add-payment (click)="user_card=false" *ngIf="addPaymentPopup" (close)='closePopup();' (submit)="closePopup(); addPayment($event);"></app-add-payment>
<app-edit-payment (click)="user_card=false" *ngIf="editPaymentPopup" (close)='closePopup();' (submit)="closePopup(); editPayment($event);" [payment]="current_payment"></app-edit-payment>
<app-delete-payment (click)="user_card=false" *ngIf="deletePaymentPopup" (close)='closePopup();' (submit)="closePopup(); deletePayment();" [payment]="current_payment"></app-delete-payment>
<app-filters-dialog (click)="user_card=false" *ngIf="filtersPopup" (close)='closePopup();' (submit)="closePopup(); filterBy($event);"></app-filters-dialog>
<app-alerts-dialog [showMessage] = 'showMessageEvent'></app-alerts-dialog>